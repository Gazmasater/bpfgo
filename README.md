bpftool btf dump file /sys/kernel/btf/vmlinux format c > vmlinux.h


INCLUDES := -D__TARGET_ARCH_$(ARCH) -I$(OUTPUT) -I../third_party/libbpf-bootstrap/libbpf/include/uapi -I$(dir $(VMLINUX)) -I$(LIBBLAZESYM_INC) -I/usr/include/bpf


+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

Ошибки, с которыми вы столкнулись, могут быть вызваны конфликтом определений функций BPF, неверным использованием типов и неявными определениями функций. Вот что можно сделать, чтобы устранить эти проблемы:

Конфликтующие определения BPF-функций: Похоже, что в bpf_helper_defs.h и bpf.h объявлены одинаковые функции (bpf_map_lookup_elem, bpf_map_update_elem, bpf_map_delete_elem). Убедитесь, что включаете только один из этих файлов. Возможно, bpf.h и так включает все необходимые заголовки, так что попробуйте удалить bpf_helper_defs.h из ebpf_test.c и оставить только bpf.h.

Использование неявной функции should_intercept: Ошибка указывает на то, что функция should_intercept вызывается без предварительного объявления. Убедитесь, что у вас есть определение или прототип этой функции перед её использованием, например:

c
Копировать код
int should_intercept();
Несоответствие типов аргументов в bpf_map_update_elem: Ошибка incompatible pointer to integer conversion предполагает, что передаётся указатель вместо целого числа. Функция bpf_map_update_elem ожидает, что первый аргумент (fd) будет целым числом, представляющим файловый дескриптор, а не указателем. Проверьте переменную active_accept4_args_map и убедитесь, что это файловый дескриптор, а не структура.

Попробуйте выполнить эти шаги и пересоберите программу.







