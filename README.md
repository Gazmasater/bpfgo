bpftool btf dump file /sys/kernel/btf/vmlinux format c > vmlinux.h


INCLUDES := -D__TARGET_ARCH_$(ARCH) -I$(OUTPUT) -I../third_party/libbpf-bootstrap/libbpf/include/uapi -I$(dir $(VMLINUX)) -I$(LIBBLAZESYM_INC) -I/usr/include/bpf


+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

Ошибка, которую вы видите, связана с конфликтами определений функций и с несовместимыми параметрами в файле ebpf_test.c. Проблемы возникают из-за нескольких определений функций eBPF в файле /tmp/.tmp8Htfer/include/bpf/bpf_helper_defs.h, таких как bpf_map_lookup_elem и bpf_map_update_elem. Кроме того, некоторые функции, такие как should_intercept и parse_address, вызываются без предварительного объявления.

Попробуйте следующие шаги, чтобы устранить ошибки:

Удалите повторные определения: Конфликт между bpf_helper_defs.h и bpf.h может быть связан с тем, что один и тот же символ определен в нескольких местах. Попробуйте исключить bpf_helper_defs.h из инклудов или использовать другой заголовочный файл для поддержки функций eBPF, например, непосредственно bpf.h.

Объявите функции перед их использованием: Убедитесь, что should_intercept и parse_address определены или объявлены перед использованием. Например, добавьте следующие объявления в начале ebpf_test.c:

c
Копировать код
int should_intercept(void);
void parse_address(void *src_addr, struct accept_args_t args);
Проверьте аргументы функций eBPF: Ошибка в строке bpf_map_update_elem и bpf_map_lookup_elem связана с несовместимыми типами аргументов. Убедитесь, что аргументы типа int fd передаются корректно, и проверьте документацию, чтобы убедиться, что количество и типы аргументов верны.

Используйте правильную версию task_struct: Ошибка incomplete definition of type 'struct task_struct' указывает на то, что task_struct определен не полностью. Это может быть вызвано отсутствием нужных заголовочных файлов. Попробуйте включить необходимые заголовочные файлы или пересмотрите использование BPF_CORE_READ.
