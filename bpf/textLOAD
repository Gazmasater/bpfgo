sudo ip netns add my_netns //sozdat
sudo ip netns exec my_netns ip link
ip netns list


clang -O2 -g -target bpf -c sk_up.c -o sk_up.o
sudo bpftool prog load sk_up.o /sys/fs/bpf/test_prog type sk_lookup
sudo bpftool prog delete id <ID программы>

sudo bpftool prog show | grep sk_lookup | awk '{print $1}'

sudo bpftool net attach sk_lookup id <prog_id> netns /var/run/netns/my_netns ifindex <ifindex>


Шаг 1: Добавьте класс управления трафиком для интерфейса lo (если он еще не был добавлен)
Это необходимо, чтобы можно было добавлять фильтры на интерфейс:


sudo tc qdisc add dev lo clsact
Шаг 2: Прикрепите программу BPF для входящего трафика
Это действие уже описано:


sudo tc filter add dev lo ingress bpf obj ./sk_up.o sec sk_lookup
Шаг 3: Прикрепите программу BPF для исходящего трафика
Теперь нужно добавить фильтр для исходящего трафика, используя egress:


sudo tc filter add dev lo egress bpf obj ./sk_up.o sec sk_lookup
dev lo — указывает на интерфейс lo.
egress — указывает, что фильтр будет работать с исходящим трафиком.
bpf obj ./sk_lookup.o — указывает на объектный файл программы BPF.
sec sk_lookup — указывает на секцию в объектном файле программы.
Шаг 4: Проверка фильтров на интерфейсе lo
Чтобы убедиться, что фильтры были успешно добавлены для обоих направлений трафика, выполните команду:


sudo tc -s filter show dev lo
Эта команда покажет статистику для обоих фильтров (входящего и исходящего трафика) на интерфейсе lo.


